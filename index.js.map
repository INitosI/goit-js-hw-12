{"version":3,"file":"index.js","sources":["../src/js/render-functions.js","../src/js/pixabay-api.js","../src/main.js"],"sourcesContent":["import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nconst loader = document.querySelector('.loader');\nexport const loadMoreDiv = document.querySelector('.load-more');\n\nexport const lightbox = new SimpleLightbox('.gallery a', {});\n\nconst gallery = document.querySelector('.gallery');\n\nexport function createGallery(images) {\n  const markup = images\n    .map(image => {\n      return `\n        <li class=\"gallery-item\">\n            <a href=\"${image.largeImageURL}\" class=\"gallery-link\">\n                <img src=\"${image.webformatURL}\" alt=\"${image.tags}\" loading=\"lazy\" class=\"gallery-img\"/>\n            </a>\n            <ul class=\"info\">\n                <li class=\"info-item\">\n                    <b>Likes</b>\n                    ${image.likes}\n                </li>\n                <li class=\"info-item\">\n                    <b>Views</b>\n                    ${image.views}\n                </li>\n                <li class=\"info-item\">\n                    <b>Comments</b>\n                    ${image.comments}\n                </li>\n                <li class=\"info-item\">\n                    <b>Downloads</b>\n                    ${image.downloads}\n                </li>\n            </ul>\n        </li>\n        `;\n    })\n    .join('');\n\n  gallery.insertAdjacentHTML('beforeend', markup);\n  lightbox.refresh();\n}\n\nexport function clearGallery() {\n  gallery.innerHTML = '';\n}\n\nexport function showLoader() {\n  if (!loader) return;\n  loader.classList.remove('hidden');\n}\n\nexport function hideLoader() {\n  if (!loader) return;\n  loader.classList.add('hidden');\n}\n\nexport function showLoadMoreButton() {\n  if (loadMoreDiv) {\n    loadMoreDiv.classList.remove('hidden');\n  }\n}\n\nexport function hideLoadMoreButton() {\n  if (loadMoreDiv) {\n    loadMoreDiv.classList.add('hidden');\n  }\n}\n","import axios from 'axios';\n\nconst BASE_URL = 'https://pixabay.com/api/';\nconst API_KEY = import.meta.env.VITE_PIXABAY_API_KEY;\naxios.defaults.baseURL = BASE_URL;\n\naxios.defaults.params = {\n  key: API_KEY,\n  image_type: 'photo',\n  orientation: 'horizontal',\n  safesearch: true,\n  per_page: 15,\n};\n\nexport async function getImagesByQuery(query, page) {\n  try {\n    const response = await axios.get('', {\n      params: {\n        q: query,\n        page: page,\n      },\n    });\n    return response.data;\n  } catch (error) {\n    throw error;\n  }\n}\n\n// export async function fetchAndRenderImages(searchQuery) {\n//   const imagesArray = [];\n//   try {\n//     const { hits } = await getImagesByQuery(searchQuery);\n//     if (!hits.length) throw new Error('No images');\n//     createGallery(hits);\n//   } catch (error) {\n//     errorToast(\n//       'Sorry, there are no images matching your search query. Please, try again!'\n//     );\n//   } finally {\n//     hideLoader();\n//     showLoadMoreButton();\n//   }\n// }\n","import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\nimport {\n  lightbox,\n  createGallery,\n  clearGallery,\n  showLoader,\n  hideLoader,\n  showLoadMoreButton,\n  hideLoadMoreButton,\n  loadMoreDiv,\n} from './js/render-functions.js';\nimport { getImagesByQuery } from './js/pixabay-api.js';\n\nlet currentPage = 1;\nlet searchQuery = null;\nexport let firstItemHeight = 0;\n// const card = document.querySelector('.gallery.item');\n// const cardHeight = card?.firstChild.getBoundingClientRect().height || 0;\n\nconst errorToast = message => {\n  const toast = iziToast.error({\n    message,\n    position: 'topRight',\n    iconUrl: new URL('./img/err-icon.svg', import.meta.url).href,\n    color: 'red',\n    class: 'custom-toast',\n    close: false,\n  });\n\n  // Добавляем кастомный крестик\n  setTimeout(() => {\n    const toastElement = document.querySelector('.custom-toast');\n    if (toastElement && !toastElement.querySelector('.toast-close-btn')) {\n      const closeBtn = document.createElement('button');\n      closeBtn.className = 'toast-close-btn';\n      closeBtn.innerHTML = '✕';\n      closeBtn.addEventListener('click', () => {\n        const parent = closeBtn.closest('.iziToast-wrapper');\n        if (parent) parent.remove();\n      });\n\n      const body = toastElement.querySelector('.iziToast-body');\n      if (body) body.appendChild(closeBtn);\n    }\n  }, 0);\n};\n\nconst form = document.querySelector('.form');\nconst searchInput = document.querySelector('.form input');\n\nform.addEventListener('submit', event => {\n  event.preventDefault();\n  currentPage = 1;\n  clearGallery();\n\n  if (!form.checkValidity()) {\n    errorToast(\n      'Sorry, there are no images matching your search query. Please, try again!'\n    );\n    hideLoadMoreButton();\n    return;\n  }\n  showLoader();\n  searchQuery = searchInput.value.trim();\n\n  fetchAndRenderImages(searchQuery, currentPage);\n\n  searchInput.value = '';\n});\n\nloadMoreDiv.addEventListener('click', () => {\n  currentPage += 1;\n  showLoader();\n  hideLoadMoreButton();\n  fetchAndRenderImages(searchQuery, currentPage);\n});\n\nconst PER_PAGE = 15;\n\nasync function fetchAndRenderImages(searchQuery, page = 1) {\n  try {\n    const data = await getImagesByQuery(searchQuery, page);\n\n    const totalHits = data?.totalHits ?? 0;\n    const hits = data?.hits ?? [];\n\n    if (hits.length === 0) {\n      if (page === 1) {\n        errorToast(\n          'Sorry, there are no images matching your search query. Please, try again!'\n        );\n      }\n      hideLoadMoreButton();\n      return;\n    }\n\n    createGallery(hits);\n\n    firstItemHeight =\n      document\n        .querySelector('.gallery')\n        ?.firstElementChild?.getBoundingClientRect().height ?? 0;\n\n    const totalPages = Math.ceil(totalHits / PER_PAGE);\n    const hasMore = page < totalPages;\n\n    if (hasMore) {\n      showLoadMoreButton();\n      return;\n    }\n\n    hideLoadMoreButton();\n    errorToast(\"We're sorry, but you've reached the end of search results.\");\n  } catch (error) {\n    errorToast(\n      'Sorry, there are no images matching your search query. Please, try again!'\n    );\n  } finally {\n    hideLoader();\n    window.scrollBy({\n      top: firstItemHeight * 5,\n      behavior: 'smooth',\n    });\n  }\n}\n"],"names":["loader","loadMoreDiv","lightbox","SimpleLightbox","gallery","createGallery","images","markup","image","clearGallery","showLoader","hideLoader","showLoadMoreButton","hideLoadMoreButton","BASE_URL","API_KEY","axios","getImagesByQuery","query","page","error","currentPage","searchQuery","firstItemHeight","errorToast","message","iziToast","toastElement","closeBtn","parent","body","form","searchInput","event","fetchAndRenderImages","PER_PAGE","data","totalHits","hits","_b","_a","totalPages"],"mappings":"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"}